package org.deiverbum.app.utils;

import static android.graphics.Typeface.BOLD;
import static org.deiverbum.app.utils.Constants.BR;
import static org.deiverbum.app.utils.Constants.BRS;
import static org.deiverbum.app.utils.Constants.CSS_RED_A;
import static org.deiverbum.app.utils.Constants.CSS_RED_Z;
import static org.deiverbum.app.utils.Constants.ERR_REPORT;
import static org.deiverbum.app.utils.Constants.ERR_RESPONSORIO;
import static org.deiverbum.app.utils.Constants.NBSP_4;
import static org.deiverbum.app.utils.Constants.NBSP_SALMOS;
import static org.deiverbum.app.utils.Constants.OBIEN;
import static org.deiverbum.app.utils.Constants.PADRENUESTRO;
import static org.deiverbum.app.utils.Constants.PRECES_IL;
import static org.deiverbum.app.utils.Constants.PRECES_R;
import static org.deiverbum.app.utils.Constants.RESP_A;
import static org.deiverbum.app.utils.Constants.RESP_R;
import static org.deiverbum.app.utils.Constants.RESP_V;

import android.graphics.Color;
import android.text.Html;
import android.text.Spannable;
import android.text.SpannableString;
import android.text.SpannableStringBuilder;
import android.text.Spanned;
import android.text.style.CharacterStyle;
import android.text.style.ForegroundColorSpan;
import android.text.style.RelativeSizeSpan;
import android.text.style.StyleSpan;

import org.deiverbum.app.model.BreviaryHour;
import org.deiverbum.app.model.Intermedia;
import org.deiverbum.app.model.LHIntercession;
import org.deiverbum.app.model.LHPsalmody;
import org.deiverbum.app.model.LHResponsoryShort;

import java.text.DateFormat;
import java.text.DateFormatSymbols;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Locale;
import java.util.Objects;

/**
 * Clase utilitaria que se usa en varias partes de la aplicaci√≥n
 *
 * @author Alfertson Cedano Guerrero
 */
public final class Utils {

    public static final String LS = System.getProperty("line.separator");
    public static final String LS2 = LS + LS;
    public static final float H3 = 1.4f;
    public static final float H2 = 1.7f;
    public static final float H4 = 1.1f;

    private static final ForegroundColorSpan liturgicalRed = new ForegroundColorSpan(Color.parseColor("#A52A2A"));

    public static SpannableStringBuilder formatTitle(String sOrigen) {
        SpannableStringBuilder ssb = new SpannableStringBuilder(toUpper(sOrigen));
        ssb.setSpan(CharacterStyle.wrap(liturgicalRed), 0, ssb.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.setSpan(CharacterStyle.wrap(new StyleSpan(BOLD)), 0, ssb.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        return ssb;
    }

    public static SpannableStringBuilder formatSubTitle(String sOrigen) {
        SpannableStringBuilder ssb = new SpannableStringBuilder(sOrigen);
        RelativeSizeSpan textSize = new RelativeSizeSpan(H3);
        ssb.setSpan(CharacterStyle.wrap(textSize), 0, ssb.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.setSpan(CharacterStyle.wrap(new StyleSpan(BOLD)), 0, ssb.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        return ssb;
    }


    public static SpannableStringBuilder ssbSmallSize(SpannableStringBuilder ssb) {
        RelativeSizeSpan smallSizeText = new RelativeSizeSpan(0.8f);
        ssb.setSpan(CharacterStyle.wrap(smallSizeText), 0, ssb.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        return ssb;
    }

    public static SpannableStringBuilder toSmallSize(String sOrigen) {
        RelativeSizeSpan smallSizeText = new RelativeSizeSpan(0.8f);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString = new SpannableString(sOrigen);
        spannableString.setSpan(CharacterStyle.wrap(smallSizeText), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;

    }

    public static SpannableStringBuilder toMediumSize(String sOrigen) {
        RelativeSizeSpan smallSizeText = new RelativeSizeSpan(0.9f);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString = new SpannableString(sOrigen);
        spannableString.setSpan(CharacterStyle.wrap(smallSizeText), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;

    }

    public static SpannableStringBuilder toSmallSizes(Spanned sOrigen) {
        RelativeSizeSpan smallSizeText = new RelativeSizeSpan(0.8f);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString = new SpannableString(sOrigen);
        spannableString.setSpan(CharacterStyle.wrap(smallSizeText), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;
    }


    public static SpannableStringBuilder toSmallSizeRed(String sOrigen) {
        RelativeSizeSpan smallSizeText = new RelativeSizeSpan(0.8f);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString = new SpannableString(sOrigen);
        spannableString.setSpan(CharacterStyle.wrap(smallSizeText), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        spannableString.setSpan(CharacterStyle.wrap(liturgicalRed), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;
    }


    public static SpannableStringBuilder fromHtmlToSmallRed(String sOrigen) {
        Spanned s = fromHtml(sOrigen);
        RelativeSizeSpan smallSizeText = new RelativeSizeSpan(0.8f);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString = new SpannableString(s);
        spannableString.setSpan(CharacterStyle.wrap(smallSizeText), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        spannableString.setSpan(CharacterStyle.wrap(liturgicalRed), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;

    }



    public static SpannableStringBuilder toH3(String sOrigen) {
        RelativeSizeSpan smallSizeText = new RelativeSizeSpan(H3);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString = new SpannableString(sOrigen);
        spannableString.setSpan(CharacterStyle.wrap(smallSizeText), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        spannableString.setSpan(CharacterStyle.wrap(new StyleSpan(BOLD)), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;

    }

    public static SpannableStringBuilder toH4(String sOrigen) {
        RelativeSizeSpan smallSizeText = new RelativeSizeSpan(H4);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString = new SpannableString(sOrigen);
        spannableString.setSpan(CharacterStyle.wrap(smallSizeText), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        spannableString.setSpan(CharacterStyle.wrap(new StyleSpan(BOLD)), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;

    }


    public static SpannableStringBuilder toH2(String sOrigen) {
        RelativeSizeSpan smallSizeText = new RelativeSizeSpan(H2);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString = new SpannableString(sOrigen);
        spannableString.setSpan(CharacterStyle.wrap(smallSizeText), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;

    }

    public static SpannableStringBuilder toH2Red(String sOrigen) {
        RelativeSizeSpan h2 = new RelativeSizeSpan(H2);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString = new SpannableString(sOrigen);
        //spannableString=fromHtml(spannableString);
        spannableString.setSpan(CharacterStyle.wrap(h2), 0,
                spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        spannableString.setSpan(CharacterStyle.wrap(liturgicalRed), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;
    }

    public static SpannableStringBuilder toH2RedNew(String sOrigen) {
        RelativeSizeSpan h2 = new RelativeSizeSpan(H2);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString =
                new SpannableString(toRedHtml(sOrigen));
        //spannableString=fromHtml(spannableString);
        spannableString.setSpan(CharacterStyle.wrap(h2), 0,
                spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        spannableString.setSpan(CharacterStyle.wrap(liturgicalRed), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;
    }

    public static SpannableStringBuilder toH3Red(String sOrigen) {
        RelativeSizeSpan smallSizeText = new RelativeSizeSpan(H3);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString = new SpannableString(sOrigen);
        spannableString.setSpan(CharacterStyle.wrap(smallSizeText), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        spannableString.setSpan(CharacterStyle.wrap(liturgicalRed), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;
    }

    public static SpannableStringBuilder toH4Red(String sOrigen) {
        RelativeSizeSpan smallSizeText = new RelativeSizeSpan(H4);
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableString spannableString = new SpannableString(sOrigen);
        spannableString.setSpan(CharacterStyle.wrap(smallSizeText), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        spannableString.setSpan(CharacterStyle.wrap(liturgicalRed), 0, spannableString.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(spannableString);
        return ssb;
    }

    public static SpannableStringBuilder toRed(String sOrigen) {
        SpannableString s = new SpannableString(sOrigen);
        s.setSpan(CharacterStyle.wrap(liturgicalRed), 0, s.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        return new SpannableStringBuilder(s);
    }

    public static SpannableStringBuilder toRedNew(SpannableStringBuilder sOrigen) {
        sOrigen.setSpan(CharacterStyle.wrap(liturgicalRed), 0, sOrigen.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        return sOrigen;
    }

    public static SpannableStringBuilder toRedHtml(String sOrigen) {
        SpannableString s = new SpannableString(fromHtml(sOrigen));

        s.setSpan(CharacterStyle.wrap(liturgicalRed), 0, s.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        return new SpannableStringBuilder(s);
    }

    /**
     * Este m√©todo es @deprecated a partir de la versi√≥n 2022.01,
     * porque conviene migrar algunos m√©todos a clases m√°s propias.
     * Usar en su lugar {@link BreviaryHour#getSaludoOficio()}
     */
    @Deprecated

    public static SpannableStringBuilder getSaludoOficio() {
        SpannableStringBuilder ssb = new SpannableStringBuilder(formatTitle("INVOCACI√ìN INICIAL"));
        ssb.append(LS2);
        SpannableStringBuilder ssbPartial = new SpannableStringBuilder("V. Se√±or, abre mis labios.");
        ssbPartial.append(LS);
        ssbPartial.append("R. Y mi boca proclamar√° tu alabanza.");
        ssbPartial.setSpan(CharacterStyle.wrap(liturgicalRed), 0, 2, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssbPartial.setSpan(CharacterStyle.wrap(liturgicalRed), 27, 29, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(ssbPartial);
        ssb.append(LS2);
        ssb.append(Utils.getFinSalmo());
        return ssb;
    }


        public static SpannableStringBuilder getSaludoEnElNombre() {
        SpannableStringBuilder ssb = new SpannableStringBuilder("");
        SpannableStringBuilder ssbPartial = new SpannableStringBuilder("V/. En el nombre del Pater, y del Hijo, y del Esp√≠ritu Saint.");
        ssbPartial.append(LS);
        ssbPartial.append("R/. Am√©n.");
        ssbPartial.setSpan(CharacterStyle.wrap(liturgicalRed), 0, 3, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssbPartial.setSpan(CharacterStyle.wrap(liturgicalRed), 62, 65, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(ssbPartial);
        ssb.append(LS2);
        return ssb;
    }

    /**
     * Este m√©todo es @deprecated a partir de la versi√≥n 2022.01,
     * porque conviene migrar algunos m√©todos a clases m√°s propias.
     * Usar en su lugar {@link BreviaryHour#getSaludoOficioForRead()}
     */
    @Deprecated
    public static SpannableStringBuilder getSaludoOficioForReader() {
        SpannableStringBuilder ssb = new SpannableStringBuilder();
        ssb.append("<p>Se√±or abre mis labios.</p>");
        ssb.append("<p>Y mi boca proclamar√° tu alabanza.</p>");
        ssb.append("<p>Gloria al Pater, y al Hijo, y al Esp√≠ritu Saint.</p>");
        ssb.append("<p>Como era en el principio ahora y siempre, por los siglos de los siglos. Am√©n.</p>");
        return (SpannableStringBuilder) fromHtml(ssb.toString());
    }

    /**
     * Este m√©todo es @deprecated a partir de la versi√≥n 2022.01,
     * porque conviene migrar algunos m√©todos a clases m√°s propias.
     * Usar en su lugar {@link BreviaryHour#getSaludoDiosMio()}
     */
    @Deprecated

    public static SpannableStringBuilder getSaludoDiosMio() {
        SpannableStringBuilder ssb = new SpannableStringBuilder(formatTitle("INVOCACI√ìN INICIAL"));
        ssb.append(LS2);
        SpannableStringBuilder ssbPartial = new SpannableStringBuilder("V. Dios m√≠o, ven en mi auxilio.");
        ssbPartial.append(LS);
        ssbPartial.append("R. Se√±or, date prisa en socorrerme.");
        ssbPartial.setSpan(CharacterStyle.wrap(liturgicalRed), 0, 2, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssbPartial.setSpan(CharacterStyle.wrap(liturgicalRed), 32, 34, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(ssbPartial);
        ssb.append(LS2);
        ssb.append(Utils.getFinSalmo());
        return ssb;
    }

    /**
     * Este m√©todo es @deprecated a partir de la versi√≥n 2022.01,
     * porque conviene migrar algunos m√©todos a clases m√°s propias.
     * Usar en su lugar {@link BreviaryHour#getSaludoDiosMioForRead()}
     */
    @Deprecated

    public static SpannableStringBuilder getSaludoDiosMioForReader() {
        SpannableStringBuilder ssb = new SpannableStringBuilder();
        ssb.append("<p>Dios m√≠o, ven en mi auxilio.</p>");
        ssb.append("<p>Se√±or, date prisa en socorrerme.</p>");
        ssb.append("<p>Gloria al Pater, y al Hijo, y al Esp√≠ritu Saint.</p>");
        ssb.append("<p>Como era en el principio ahora y siempre, por los siglos de los siglos. Am√©n.</p>");
        return (SpannableStringBuilder) fromHtml(ssb.toString());
    }

    /**
     * @deprecated desde v. 2022.01 - Usar en su lugar {@link BreviaryHour#getConclusionHorasMayores()}
     * @return Conclusi√≥n formateada
     */
    @Deprecated

    public static SpannableStringBuilder getConclusionHorasMayores() {
        SpannableStringBuilder ssb = new SpannableStringBuilder(formatTitle("CONCLUSI√ìN"));
        ssb.append(LS2);
        SpannableStringBuilder ssbPartial = new SpannableStringBuilder("V. El Se√±or nos bendiga, nos guarde de todo mal y nos lleve a la vida eterna.");
        ssbPartial.append(LS);
        ssbPartial.append("R. Am√©n.");
        ssbPartial.setSpan(CharacterStyle.wrap(liturgicalRed), 0, 2, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssbPartial.setSpan(CharacterStyle.wrap(liturgicalRed), 78, 80, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(ssbPartial);
        return ssb;
    }

    /**
     * @deprecated
     * Reemplazar por {@link BreviaryHour#getConclusionHorasMayoresForRead()}
     * @return Texto de la conclusi√≥n
     */
    @Deprecated
    public static SpannableStringBuilder getConclusionHorasMayoresForRead() {
        SpannableStringBuilder ssb = new SpannableStringBuilder();
        ssb.append(fromHtml("<p>El Se√±or nos bendiga, nos guarde de todo mal y nos lleve a la vida eterna.</p>"));
        ssb.append(fromHtml("<p>Am√©n.</p>"));
        return ssb;
    }

    /**
     * @deprecated Usar {@link Intermedia#getConclusionHora()}
     * @return Una cadena con la conclusi√≥n
     */
    public static SpannableStringBuilder getConclusionIntermedia() {
        SpannableStringBuilder ssb = new SpannableStringBuilder(formatTitle("CONCLUSI√ìN"));
        ssb.append(LS2);
        SpannableStringBuilder ssbPartial = new SpannableStringBuilder("V. Bendigamos al Se√±or.");
        ssbPartial.append(LS);
        ssbPartial.append("R. Demos gracias a Dios.");
        ssbPartial.setSpan(CharacterStyle.wrap(liturgicalRed), 0, 2, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssbPartial.setSpan(CharacterStyle.wrap(liturgicalRed), 24, 26, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
        ssb.append(ssbPartial);
        return ssb;
    }

    /**
     * @deprecated Usar {@link Intermedia#getConclusionHoraForRead()}
     * @return Una cadena con la conclusi√≥n
     */
    public static SpannableStringBuilder getConclusionIntermediaForRead() {
        SpannableStringBuilder ssb = new SpannableStringBuilder();
        ssb.append("<p>Bendigamos al Se√±or.</p>");
        ssb.append("<p>Demos gracias a Dios.</p>");
        return (SpannableStringBuilder) fromHtml(ssb.toString());
    }

    /**
     * @deprecated  migrar a {@link org.deiverbum.app.model.Kyrie}
     */

    public static SpannableStringBuilder getKyrie(int type) {
        SpannableStringBuilder ssb = new SpannableStringBuilder();

        switch (type) {
            case 0:
                String text = "Yo confieso ante Dios todopoderoso " + LS +
                        "y ante vosotros, hermanos " + LS +
                        "que he pecado mucho" + LS +
                        "de pensamiento, palabra, obra y omisi√≥n:" + LS +
                        "por mi culpa, por mi culpa, por mi gran culpa." + LS2 +
                        "Por eso ruego a santa Mar√≠a, siempre Virgen," + LS +
                        "a los √°ngeles, a los santos y a vosotros, hermanos," + LS +
                        "que interced√°is por m√≠ ante Dios, nuestro Se√±or.";

                ssb.append(text);

                break;
            case 1:
                ssb.append("V. Se√±or, ten misericordia de nosotros.");
                ssb.append(LS);
                ssb.append("R. Porque hemos pecado contra ti.");
                ssb.append(LS2);
                ssb.append("V. Mu√©stranos, Se√±or, tu misericordia.");
                ssb.append(LS);
                ssb.append("R. Y danos tu salvaci√≥n.");
                ssb.setSpan(CharacterStyle.wrap(liturgicalRed), 0, 2, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
                ssb.setSpan(CharacterStyle.wrap(liturgicalRed), 39, 41, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
                ssb.setSpan(CharacterStyle.wrap(liturgicalRed), 74, 76, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
                ssb.setSpan(CharacterStyle.wrap(liturgicalRed), 113, 115, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);

                break;
            case 2:
                ssb.append("V. T√∫ que has sido enviado a sanar los corazones afligidos: Se√±or, ten piedad.");
                ssb.append(LS);
                ssb.append("R. Se√±or, ten piedad.");
                ssb.append(LS2);

                ssb.append("V. T√∫ que has venido a llamar a los pecadores: Cristo, ten piedad.");
                ssb.append(LS);

                ssb.append("R. Cristo, ten piedad.");
                ssb.append(LS2);

                ssb.append("V. T√∫ que est√°s sentado a la derecha del Pater para interceder por nosotros: Se√±or, ten piedad.");
                ssb.append(LS);

                ssb.append("R. Se√±or, ten piedad.");
                ssb.setSpan(CharacterStyle.wrap(liturgicalRed), 0, 2, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
                ssb.setSpan(CharacterStyle.wrap(liturgicalRed), 78, 80, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);

                ssb.setSpan(CharacterStyle.wrap(liturgicalRed), 100, 103, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
                ssb.setSpan(CharacterStyle.wrap(liturgicalRed), 169, 172, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);

                ssb.setSpan(CharacterStyle.wrap(liturgicalRed), 190, 194, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
                ssb.setSpan(CharacterStyle.wrap(liturgicalRed), 289, 292, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);

            default:
                ssb.append("");
                break;
        }


        return ssb;

    }

    /**
     * M√©todo que crea las preces *** terminar descripci√≥n luego
     * @deprecated  migrar a {@link LHIntercession}
     *
     * @param precesIntro Una matriz con las diferentes partes del responsorio. Antes de pasar el par√°metro evauluar que la matriz no sea nula
     * @param precesTexto    Un valor num√©rico para indicar de que forma es el responsorio y actuar en consecuencia
     * @return Una cadena con el responsorio completo, con sus respectivos V. y R.
     */
    @Deprecated
    public static String getPreces(String precesIntro, String precesTexto) {
        String sFinal;
        String[] introArray = precesIntro.split("\\|");
        if (introArray.length == 3) {
            sFinal = introArray[0] + BRS + "<i>" + introArray[1] + "</i>" + BRS + precesTexto + BRS + introArray[2];
        } else {
            sFinal = precesIntro + BRS + precesTexto;

        }
        sFinal = getFormato(sFinal);
        return sFinal;
    }

    //TODO debe dejarse de usar caracteres en griego para los reemplazos

    /**
     * <p>Sustituye y/o formatea determinados caracteres seg√∫n una convenci√≥n de marcado ideada por m√≠ mismo.</p>
     * <p>La convenci√≥n es la siguiente:</p>
     * <ul>
     *     <li></li>
     * </ul>
     * @param sOrigen Cadena original para hacer el reemplazo
     * @return La cadena formateada
     */
    public static String getFormato(String sOrigen) {
        String sFormateado;
        //Œ± Œ≤ Œ≥ Œ¥ Œµ œù œõ Œ∂ Œ∑ Œ∏ Œπ Œ∫ Œª Œº ŒΩ Œæ Œø œÄ œü œô œÅ œÉ œÑ œÖ œÜ œá œà œâ œ°
        /*
        u2220: ‚à† ‚à° ‚à¢ ‚à£ ‚à§ ‚à• ‚à¶ ‚àß ‚à® ‚à© ‚à™ ‚à´  ‚à≠ ‚àÆ ‚àØ ‚à∞ ‚à± ‚à≤ ‚à≥ ‚à¥ ‚àµ ‚à∂ ‚à∑ ‚à∏ ‚àπ ‚à∫ ‚àª ‚àº ‚àΩ ‚àæ ‚àø

        u2240: ‚âÄ ‚âÅ ‚âÇ ‚âÉ ‚âÑ ‚âÖ ‚âÜ ‚âá ‚âà ‚ââ ‚âä ‚âã ‚âå ‚âç ‚âé ‚âè ‚âê ‚âë ‚âí ‚âì ‚âî ‚âï ‚âñ ‚âó ‚âò ‚âô ‚âö ‚âõ ‚âú ‚âù ‚âû ‚âü

        u2260: ‚â† ‚â° ‚â¢ ‚â£ ‚â§ ‚â• ‚â¶ ‚âß ‚â® ‚â© ‚â™ ‚â´ ‚â¨ ‚â≠ ‚âÆ ‚âØ ‚â∞ ‚â± ‚â≤ ‚â≥ ‚â¥ ‚âµ ‚â∂ ‚â∑ ‚â∏ ‚âπ ‚â∫ ‚âª ‚âº ‚âΩ ‚âæ ‚âø

        u2280: ‚äÄ ‚äÅ ‚äÇ ‚äÉ ‚äÑ ‚äÖ ‚äÜ ‚äá ‚äà ‚äâ ‚ää ‚äã ‚äå ‚äç ‚äé ‚äè ‚äê ‚äë ‚äí ‚äì ‚äî ‚äï ‚äñ ‚äó ‚äò ‚äô ‚äö ‚äõ ‚äú ‚äù ‚äû ‚äü

        u22A0: ‚ä† ‚ä° ‚ä¢ ‚ä£ ‚ä§ ‚ä• ‚ä¶ ‚äß ‚ä® ‚ä© ‚ä™ ‚ä´ ‚ä¨ ‚ä≠ ‚äÆ ‚äØ ‚ä∞ ‚ä± ‚ä≤ ‚ä≥ ‚ä¥ ‚äµ ‚ä∂ ‚ä∑ ‚ä∏ ‚äπ ‚ä∫ ‚äª ‚äº ‚äΩ ‚äæ ‚äø
        BibleReading de la Pasi√≥n: œÑ : Jes√∫s  ŒΩ : Cronista œÇ : S

        Nuevos valores desde v. 2022.01.01:
            ‚äû en lugar de œÑ ... ‚úö.
            ‚äù en lugar de ŒΩ ... C.
            ‚äü en lugar de œÇ ... S.
            ‚äì  en lugar de ∆û ... N.
            ‚äö  en lugar de ‚Ñá ... O bien


*/
        sFormateado = sOrigen
                .replace("_", NBSP_SALMOS)
                .replace("¬ß", BRS)
                .replace("~", BR)
                .replace("¬¶", NBSP_4)
                .replace("‚ä£", BR + NBSP_4)
                .replace("‚â†", PRECES_R)
                .replace("‚àû", PRECES_IL)
                .replace("‚äö", OBIEN)
                .replace("‚Ä†", CSS_RED_A + " ‚Ä† " + CSS_RED_Z)
                .replace("‚äì", CSS_RED_A + " N. " + CSS_RED_Z)
                .replace("‚±§", CSS_RED_A + " R. " + CSS_RED_Z)
                .replace("‚ü®", CSS_RED_A + "(" + CSS_RED_Z)
                .replace("‚ü©", CSS_RED_A + ")" + CSS_RED_Z)
                .replace("‚±±", CSS_RED_A + "V/." + CSS_RED_Z)
                .replace("‚±¥", CSS_RED_A + "R/." + CSS_RED_Z)
                .replace("∆¶", CSS_RED_A + " R/. " + CSS_RED_Z + BRS)
//NEW
                .replace("‚Ñü", CSS_RED_A + "‚Ñü." + CSS_RED_Z)
                //.replace("‚Ñü",  toRed("‚Ñü") )

                .replace("‚Ñ£", CSS_RED_A + "‚Ñ£." + CSS_RED_Z)
                .replace("‚âÄ", BR + NBSP_4 + NBSP_4)
                .replace("~", BR)
                .replace("¬ß", BRS)
                .replace("‚à∏", BRS)
                .replace("‚äû", CSS_RED_A + "‚úö. " + CSS_RED_Z)
                .replace("‚äù", CSS_RED_A + "C. " + CSS_RED_Z)
                .replace("‚äü", CSS_RED_A + "S. " + CSS_RED_Z)
                .replace("[rubrica]", CSS_RED_A)
                .replace("[/rubrica]", CSS_RED_Z)
        ;


        return sFormateado;
    }

    public static String replaceByTime(String mText, int timeID) {
        String sFormateado;
        if (timeID == 6) {
            sFormateado = mText
                    .replace(" ∆§.", " Aleluya.")
                    .replace("∆§.", " Aleluya.")

                    .replace("∆§", " Aleluya.")

                    .replace("Œ±", " Aleluya.")
                    .replace("Œ±Œ±", " Aleluya, aleluya.");
        } else {
            sFormateado = mText
                    .replace("∆§.", "")
                    .replace("∆§", "")

                    .replace("Œ±.", "")
                    .replace("Œ±Œ±", "")
                    .replace("Œ±", "");

        }

        return sFormateado;
    }

    //Ojo soluci√≥n a fromHTML deprecated... ver: http://stackoverflow.com/questions/37904739/html-fromhtml-deprecated-in-android-n
    public static Spanned fromHtml(String html) {
        String s = getFormato(html);
        Spanned result;
        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.N) {
            result = Html.fromHtml(s, Html.FROM_HTML_MODE_LEGACY);
        } else {
            result = Html.fromHtml(s);
        }
        return result;
    }

    public static SpannableStringBuilder fromHtmlSmall(String html) {
        String s = getFormato(html);
        //SpannableString ss=toSmallSizes(html);
        Spanned result;
        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.N) {
            result = Html.fromHtml(s, Html.FROM_HTML_MODE_LEGACY);
        } else {
            result = Html.fromHtml(s);
        }
        SpannableStringBuilder ssb = new SpannableStringBuilder(result);

        return toSmallSizes(ssb);
    }

    /**
     * Este m√©todo es un ayudador para la lectura de voz,
     * que intenta quitar ciertas combinaciones de caracteres que distraer√≠an la atenci√≥n
     * durante la lectura de voz, porque son pronunciables.
     * Remueve tambi√©n ciertos delimitadores que se usan
     * para dar formato al texto en la vista
     *
     * @param sOrigen Cadena original
     * @return La cadena sin las comillas
     */
    public static String stripQuotation(String sOrigen) {
        String sFormateado;
        sFormateado = sOrigen
                .replace("¬´", "")
                .replace(".¬ª", "¬ª.")
                .replace("\"", "")
                .replace("'", "")
                .replace("‚Äú", "")
                .replace("‚Äù", "")
                .replace("(...)", ".")
                .replace("(", "")
                .replace(")", "")
                .replace("...", ".")
                .replace("[...]", "")
                .replace("œÇ", "")
                .replace("ŒΩ", "")
                .replace("œÑ", "")
                .replace("*", "")
                .replace("‚Äî", "")
                //.replace("√º", "u")

                .replaceAll("(?s)[\\[rubrica].*?/rubrica]", "")
        ;


        return sFormateado.trim();
    }

    /**
     * Este m√©todo es un ayudador para la lectura de voz,
     * que agrega el punto al final de aquellos contenidos que no lo tengan.
     * El punto es el car√°cter que se usa para separar los bloques de lectura de voz.
     *
     * @param sOrigen La cadena original
     * @return Cadena con final normalizado
     */
    public static String normalizeEnd(String sOrigen) {
        return sOrigen.endsWith(".") ? sOrigen : String.format("%s.",sOrigen);
    }

    /**
     * M√©todo que limpia la segunda parte de la ant√≠fona, en el caso del s√≠mblo ‚Ä†
     * @deprecated Desde 2022.01 - Usar {@link LHPsalmody#getAntifonaLimpia(String)}
     * @param sAntifona Una cadena con el texto de la ant√≠fona
     * @return La misma cadena, pero sin el referido s√≠mbolo
     */

    @Deprecated
    public static String getAntifonaLimpia(String sAntifona) {
        return sAntifona.replace("‚Ä†", "");
    }

    /**
     * @deprecated Desde la versi√≥n 2022.01. Usar en su lugar {@link LHResponsoryShort#getAll()}
     * <p>M√©todo que crea la cadena completa de un responsorio dado.</p>
     *
     * @param respArray Una matriz con las diferentes partes del responsorio. Antes de pasar el par√°metro evauluar que la matriz no sea nula
     * @param nForma    Un valor num√©rico para indicar de que forma es el responsorio y actuar en consecuencia
     * @return Una cadena con el responsorio completo, con sus respectivos V. y R.
     */

    @Deprecated
    public static String getResponsorio(String[] respArray, int nForma) {
        String sResponsorio = ERR_RESPONSORIO + BR + "Tama√±o del responsorio: " + respArray.length + " C√≥digo forma: " + nForma + BR;
        switch (nForma) {
            case 1:
                if (respArray.length == 3) {
                    sResponsorio =
                            RESP_R + respArray[0] + RESP_A + respArray[1] + BRS +
                                    RESP_V + respArray[2] + BRS +
                                    RESP_R + Character.toUpperCase(respArray[1].charAt(0)) + respArray[1].substring(1);
                }
                break;

            case 2:
                sResponsorio =
                        RESP_R + respArray[0] + RESP_A + respArray[1] + BRS +
                                RESP_V + respArray[2] + BRS +
                                RESP_R + Character.toUpperCase(respArray[1].charAt(0)) + respArray[1].substring(1);

                break;


            case 6001230:
                /*
                 *6 partes distribuidas as√≠: 0-0-1-2-3-0, de ah√≠ el c√≥digo 6001230... si no, imposible entenderse
                 *Suele ser el modelo de responsorio para Laudes
                 */
                if (respArray.length == 4) {

                    sResponsorio =
                            RESP_V + respArray[0] + BR +
                                    RESP_R + respArray[0] + BRS +
                                    RESP_V + respArray[1] + BR +
                                    RESP_R + respArray[2] + BRS +
                                    RESP_V + respArray[3] + BR +
                                    RESP_R + respArray[0] + BR;
                }
                break;


            case 6001020:
                if (respArray.length == 3) {

                    sResponsorio =
                            RESP_V + respArray[0] + BR +
                                    RESP_R + respArray[0] + BRS +
                                    RESP_V + respArray[1] + BR +
                                    RESP_R + respArray[0] + BRS +
                                    RESP_V + respArray[2] + BR +
                                    RESP_R + respArray[0] + BR;
                }
                break;


            case 4:
                sResponsorio =
                        RESP_V + respArray[0] + BR +
                                RESP_R + respArray[0] + BRS +
                                RESP_V + respArray[1] + BR +
                                RESP_R + respArray[0] + BRS +
                                RESP_V + respArray[2] + BR +
                                RESP_R + respArray[0] + BR;
                break;

            case 201:
                sResponsorio =
                        RESP_V + respArray[0] + BR +
                                RESP_R + respArray[1] + BR;
                break;


            default:
                break;
        }
        return sResponsorio;


    }


    /**
     * @deprecated desde la versi√≥n 2022.01. Usar en su lugar {@link LHResponsoryShort#getAllForRead()}
     * <p>M√©todo que crea la cadena completa de un responsorio dado destinado a la lectura de voz.</p>
     *
     * @param respArray Una matriz con las diferentes partes del responsorio. Antes de pasar el par√°metro evauluar que la matriz no sea nula
     * @param nForma    Un valor num√©rico para indicar de que forma es el responsorio y actuar en consecuencia
     * @return Una cadena con el responsorio completo, con sus respectivos V. y R.
     */
    @Deprecated
    public static String getResponsorioForReader(String[] respArray, int nForma) {
        String sResponsorio = ERR_RESPONSORIO + BR + "Tama√±o del responsorio: " + respArray.length + " C√≥digo forma: " + nForma + BR;
        switch (nForma) {
            case 1:
                if (respArray.length == 3) {
                    sResponsorio =
                            respArray[0] + respArray[1] + BRS +
                                    respArray[2] + BRS +
                                    Character.toUpperCase(respArray[1].charAt(0)) + respArray[1].substring(1);
                }
                break;

            case 2:
                sResponsorio =
                        respArray[0] + respArray[1] + BRS +
                                respArray[2] + BRS +
                                Character.toUpperCase(respArray[1].charAt(0)) + respArray[1].substring(1);

                break;


            case 6001230:

                if (respArray.length == 4) {

                    sResponsorio =
                            respArray[0] + BR +
                                    respArray[0] + BRS +
                                    respArray[1] + BR +
                                    respArray[2] + BRS +
                                    respArray[3] + BR +
                                    respArray[0] + BRS;
                }
                break;


            case 6001020:

                if (respArray.length == 3) {

                    sResponsorio =
                            respArray[0] + BR +
                                    respArray[0] + BRS +
                                    respArray[1] + BR +
                                    respArray[0] + BRS +
                                    respArray[2] + BR +
                                    respArray[0] + BRS;
                }
                break;


            case 4:
                sResponsorio =
                        respArray[0] + BR +
                                respArray[0] + BRS +
                                respArray[1] + BR +
                                respArray[0] + BRS +
                                respArray[2] + BR +
                                respArray[0] + BRS;
                break;

            case 201:
                sResponsorio =
                        respArray[0] + BR +
                                respArray[1] + BRS;
                break;

            default:
                break;
        }
        return sResponsorio;


    }

    /**
     * @deprecated Usar en su lugar {@link org.deiverbum.app.model.TeDeum#getTextoSpan()}
     * @return Texto del Te Deum
     */
    @Deprecated
    public static Spanned getTeDeum() {
        String teDeum = "<p>Se√±or, Dios eterno, alegres te cantamos, <br />a ti nuestra alabanza, <br />a ti, Pater del cielo, te aclama la creaci√≥n. <br /><br />Postrados ante ti, los √°ngeles te adoran <br />y cantan sin cesar: <br /><br />Saint, santo, santo es el Se√±or, <br />Dios del universo; <br />llenos est√°n el cielo y la tierra de tu gloria. <br /><br />A ti, Se√±or, te alaba el coro celestial de los ap√≥stoles, <br />la multitud de los profetas te enaltece, <br />y el ej√©rcito glorioso de los m√°rtires te aclama. <br /><br />A ti la Iglesia santa, <br />por todos los confines extendida, <br />con j√∫bilo te adora y canta tu grandeza: <br /><br />Pater, infinitamente santo, <br />Hijo eterno, unig√©nito de Dios, <br />Saint Esp√≠ritu de amor y de consuelo. <br /><br />Oh Cristo, t√∫ eres el Rey de la gloria, <br />t√∫ el Hijo y Palabra del Pater, <br />t√∫ el Rey de toda la creaci√≥n. <br /><br />T√∫, para salvar al hombre, <br />tomaste la condici√≥n de esclavo <br />en el seno de una virgen. <br /><br />T√∫ destruiste la muerte <br />y abriste a los creyentes las puertas de la gloria. <br /><br />T√∫ vives ahora, <br />inmortal y glorioso, en el reino del Pater. <br /><br />T√∫ vendr√°s alg√∫n d√≠a, <br />como juez universal. <br /><br />Mu√©strate, pues, amigo y defensor <br />de los hombres que salvaste. <br /><br />Y rec√≠belos por siempre all√° en tu reino, <br />con tus santos y elegidos. <br /><br />Salva a tu pueblo, Se√±or, <br />y bendice a tu heredad. <br /><br />S√© su pastor, <br />y gu√≠alos por siempre. <br /><br />D√≠a tras d√≠a te bendeciremos <br />y alabaremos tu nombre por siempre jam√°s. <br /><br />D√≠gnate, Se√±or, <br />guardarnos de pecado en este d√≠a. <br /><br />Ten piedad de nosotros, Se√±or, <br />ten piedad de nosotros. <br /><br />Que tu misericordia, Se√±or, venga sobre nosotros, <br />como lo esperamos de ti. <br /><br />A ti, Se√±or, me acojo, <br />no quede yo nunca defraudado.</p>";
        return fromHtml(teDeum);
    }


    /**
     * @deprecated Usar en su lugar {@link LHPsalmody#getNoGloria()}
     * @return Texto del "No se dice Gloria..."
     */
    @Deprecated
    public static SpannableStringBuilder getNoGloria() {
        SpannableStringBuilder ssb = new SpannableStringBuilder("No se dice Gloria");
        return toRedNew(ssb);
    }

    /**
     * @deprecated Usar en su lugar {@link LHPsalmody#getFinSalmo()}
     * @return Fin del salmo para la vista
     */
    @Deprecated
    public static Spanned getFinSalmo() {
        String fin = "Gloria al Pater, y al Hijo, y al Esp√≠ritu Saint." + BR
                + NBSP_SALMOS + "Como era en el principio ahora y siempre, "
                + NBSP_SALMOS + "por los siglos de los siglos. Am√©n.";
        return fromHtml(fin);
    }

    /**
     * @deprecated Usar en su lugar {@link LHPsalmody#getFinSalmoForRead()}
     * @return Fin del salmo para lectura
     */
    @Deprecated
    public static  Spanned getFinSalmoForRead() {
        String fin = "<p>Gloria al Pater, y al Hijo, y al Esp√≠ritu Saint.<br />" +
                "Como era en el principio ahora y siempre, "
                + "por los siglos de los siglos. Am√©n.</p>";
        return fromHtml(fin);
    }

    @Deprecated
    public static Spanned getPadreNuestro() {

        return fromHtml(PADRENUESTRO);
    }

    /**
     * M√©todo que devuelve la fecha del sistema en formato yyyyMMdd
     *
     * @return Una cadena con la fecha
     */

    public static String getHoy() {
        SimpleDateFormat format = new SimpleDateFormat("yyyyMMdd", Locale.getDefault());
        return format.format(new Date());
    }

    /**
     * M√©todo que devuelve la fecha del sistema en forma legible: 22 de Agosto de 1972
     *
     * @return Una cadena con la fecha
     */

    public static String getFecha() {
        SimpleDateFormat mFormat = new SimpleDateFormat("dd 'de' MMMM yyyy", Locale.getDefault());
        return mFormat.format(new Date());
    }

    /**
     * M√©todo que formatea una fecha dada en forma legible larga: 22 de Agosto de 1972
     * @param dateString La fecha a formatear
     * @return Una cadena con la fecha
     */

    public static String getLongDate(String dateString) {
        SimpleDateFormat longFormat =
                new SimpleDateFormat("EEEE d 'de' MMMM 'de' yyyy", new Locale("es", "ES"));
        DateFormat df = new SimpleDateFormat("yyyyMMdd");
        try {
            return longFormat.format(Objects.requireNonNull(df.parse(dateString)));
        } catch (ParseException e) {
            return "";
        }
    }

    /**
     * Formatea una fecha seg√∫n el patr√≥n: 22 de Agosto 1972 para mostrarla en la barra superior.
     * @param dateString La fecha a formatear
     * @return Una cadena con la fecha
     */

    public static String getTitleDate(String dateString) {
        SimpleDateFormat sdf =
                new SimpleDateFormat("dd 'de' MMMM yyyy", new Locale("es", "ES"));
        DateFormat df = new SimpleDateFormat("yyyyMMdd");
        try {
            return sdf.format(Objects.requireNonNull(df.parse(dateString)));
        } catch (ParseException e) {
            return "";
        }
    }

    /**
     * Formatea una cadena de fecha haci√©ndola apta para consultas en Firebase
     * @param date La cadena con la fecha
     * @return La cadena formateada para Firebase
     * @since 2022.01
     */
    public static String toDocument(String date) {
        return String.format("%s/%s/%s",
                date.substring(0, 4),
                date.substring(4, 6),
                date.substring(6, 8)
        );
    }


    /**
     * Quita el car√°cter / a las fechas que son pasadas inicialmente
     * para buscar datos en Firebase, a fin de hacer peticiones de Api
     * @param dateString Cadena con la fecha
     * @return La cadena limpia
     * @since 2022.01
     */
    public static String cleanDate(String dateString) {
        return dateString.replaceAll("/","");
    }

    /**
     * Crea mensajes de error personalizados
     * @param msg El mensaje de error
     * @param params Los par√°metros que se usaron para obtener la informaci√≥n en el contexto
     * @return Una cadena con el mensaje personalizado
     * @since 2022.01
     */
    public static String createErrorMessage(String msg, String params) {
        return String.format("%s\nPar√°metros: %s",msg,params);
    }

    public static String createErrorMessage(String msg) {
        return String.format("Ha ocurrido el siguiente error:%s\n%s",msg,ERR_REPORT);
    }

    /**
     * Obtiene las dos cifras del mes desde una cadena de fecha
     * @param date La fecha en formato yyyymmdd
     * @return Una cadena con la parte del mes
     * @since 2022.1
     */
    public static String getMonth(String date) {
        return date.substring(4, 6);
    }

    /**
     * Obtiene las dos cifras del d√≠a desde una cadena de fecha
     * @param date La fecha en formato yyyymmdd
     * @return Una cadena con la parte del d√≠a
     * @since 2022.1
     */
    public static String getDay(String date) {
        return date.substring(6, 8);
    }

    public static String getOrdinal(int i) {
            switch (i) {
                case 1:
                    return "Primera";

                case 2:
                    return "Segunda";

                case 3:
                    return "Tercera";
                case 4:
                    return "Cuarta";
                case 5:
                    return "Quinta";
                case 6:
                    return "Sexta";
                case 7:
                    return "S√©ptima";
                case 8:
                    return "Octava";
                case 9:
                    return "Novena";
                default:
                    return "";


            }
        }

    public static String getDayName(int day) {
        if (day > 0 && day <= 7) {

            Locale locale = new Locale("es", "ES");
            DateFormatSymbols symbols = new DateFormatSymbols(locale);
            String[] dayNames = symbols.getWeekdays();
            return dayNames[day];
        }
        return "";
    }

    public static String pointAtEnd(String s) {
        return String.format("%s.",s);
    }
    public static String toUpper(String s) {
        return s.toUpperCase();
    }
    public static String toLower(String s) {
        return s.toLowerCase();
    }


}
